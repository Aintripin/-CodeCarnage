Щас будем разбираться с Sidebar'ом - он у нас не адаптивный

> `Sidebar.tsx`:

![[Pasted image 20241107170810.png]]

Если у нас Sidebar свёрнут, то показываем стрелочку вправо, если нет - то влево


Терь стилизуем:

>`Sidebar.modules.scss`:

![[Pasted image 20241107171547.png]]


Терь сделаем темы для кнопки

Темой `background` мы будем 

> `Button.tsx`:

![[Pasted image 20241107173239.png]]


> `Button.module.scss`:

![[Pasted image 20241107173416.png]]

Второстепенный цвет - у нас яркий и насыщенный, а primary - наоборот. Исправим:

Если мы нажмём на сами сылки, нас перекинет на `normal.scss`:

>`normal.scss`:

![[Pasted image 20241107174224.png]]

Мы их тут поменяем местами

Тоже самое сделаем в другой теме:

> `dark.scss`:

![[Pasted image 20241107174312.png]]


> `Button.module.scss`:

Поставим `border: none`, т.е. рамки не будет:

![[Pasted image 20241107174418.png]]

Тоже самое сделаем для `inverted`:

![[Pasted image 20241107174449.png]]


Терь вернёмся к компоненту `Sidebar`а и добавим нужную тему на кнопку. Тут будет:

![[Pasted image 20241107174549.png]]

Щас у нас вот так:

![[Pasted image 20241107174639.png]]

Цвета, по мнению Ulbi, нужные

Но по поводу размеров и расположения есть вопросы

>`Button.tsx`:

Дадим возможность кнопки быть квадратной 

![[Pasted image 20241107174752.png]]


Для этого добавим в props поле `square`

![[Pasted image 20241107174833.png]]

Это будем добавлять, как дополнительный класс. Чтобы сильно не захламлять JSX, вынесем моды в отдельный объект:

![[Pasted image 20241107175028.png]]

Вот так:

![[Pasted image 20241107175113.png]]

Сделаем это типа `Record`, где ключ - это строка, а значение - boolean переменная

Терь сделаем вот так:

![[Pasted image 20241107175202.png]]

Т.е. если `square` навешиваем. Если нет, удаляем

> `Button.module.scss`:

![[Pasted image 20241107175249.png]]

Пока ширину и высоту сделаем по 40 пикселей

Пока что будет вот так за'hardcode'жено, но потом дадим возможность управлять этими размерами извне

![[Pasted image 20241107175345.png]]

Терь кнопка +- такая, как надо:

![[Pasted image 20241107175417.png]]

##### Терь научимся управлять размерами кнопки. У нас щас 40x40, а если надо по(-меньше/-больше)


> `Button.tsx`:

Щас ему пришла идея "переименовать для однообразности" (`shift` + `F6`, кстати) вот это:

![[Pasted image 20241107175559.png]]

На:

![[Pasted image 20241107175615.png]]

Делаем это с помощью WS, чтобы сразу во всех местах поменялось 

Терь вот такую хуйню добавим:

> `Button.tsx`:

![[Pasted image 20241107175719.png]]

> `Button.module.scss`:

Теперь, если `square` используется совместно с `size_m`, то мы будем делать размер кнопки `m`. Размеры мы возьмём, такие же, как и у шрифтов. Посмотреть это можно:

`global.scss`:

![[Pasted image 20241107175946.png]]

Только использовать будем не `font-size`, а `font-line`. Это для того, чтобы шрифт помещался в эту кнопку

Ещё добавим размер `xl`:

![[Pasted image 20241107180131.png]]

Тут его увеличим на 8 просто, как и другие

> `Button.module.scss`:

Уберём `padding`'и для всех размеров квадратных кнопок

![[Pasted image 20241107180320.png]]

И терь ниже продублируем размеры:

![[Pasted image 20241107180353.png]]

Для кнопок



Терь вернёмся в 

> `Button.tsx`:

![[Pasted image 20241107180454.png]]

Терь `mods` по аналогии с темой:

![[Pasted image 20241107180535.png]]


Классы, у которых значения всегда `true` лучше добавлять в additional классы в массив, а не в моды

Терь по умолчанию кнопка выглядит вот так:

![[Pasted image 20241107180646.png]]

Мы можем управлять её размерами извне

> `Sidebar.tsx`:

![[Pasted image 20241107180810.png]]


> `Button.module.scss`:

Тут добавим ещё ко всем размерам кнопки по размеру шрифта:

![[Pasted image 20241107180908.png]]

>`Sidebar.tsx`:

В самом sidebar заменим размер на `l` (`xl` - выглядит не очень):

![[Pasted image 20241107181026.png]]

Плюс, саму кнопку надо ещё правильно спозиционировать. Мы её двигали на `40px`. Щас подвинем на `32px`

> `Sidebar.module.scss`:

![[Pasted image 20241107181221.png]]

Можно было бы тоже выехать на переменных. Но, т.к. кнопку мы двигаем, как хотим, то исользовать их необязательно

#### Мы добавили несколько пропсов для компонента `Button`. Теперь для этого всего нужно написать SB, потому что компонент `Button` - часто используемая штука

> `Button.stories.tsx`:

![[Pasted image 20241107181539.png]]


Терь также сделаем состояние для квадратной кнопки

![[Pasted image 20241107181640.png]]

Терь продублируем это всё, но для трёх размеров:

![[Pasted image 20241107181736.png]]

Насчёт размера `M` - он у нас и так по дефолту


#### Запустим SB:

```BASH:
npm run storybook
```


Види такое:

![[Pasted image 20241107181847.png]]


Он решает, "чтобы было лучше видно" заменить тему с `background` на `background inverted`

![[Pasted image 20241107182008.png]]


У нас большинство тем без отступов:

![[Pasted image 20241107182040.png]]

Т.е. это такая плоская кнопка с текстом

Для всех этих состояний, по-хорошему, добавить отступы, чтобы кнопка была более объёмной


>`Button.module.scss`:

![[Pasted image 20241107182303.png]]

Мы поле `padding` перенесли из `clear` в `button`

И щас будет вот так:

![[Pasted image 20241107182332.png]]

А для `square`-кнопки и `clear` это обнуляем

Ещё чуть `padding`'и уменьшим вот так:

![[Pasted image 20241107182416.png]]


> `Button.module.scss`:

Вот эти размеры:


![[Pasted image 20241107182509.png]]

Мы задаём только для кнопок, которые имеют пропс `square`. Т.е. для квадратных 

		Для обычных кнопок, по-хорошему, тоже надо ументь задавать размеры

Короче, вот эти поля вырезаем:

![[Pasted image 20241107182609.png]]

И теперь сделаем так, чтобы размеры можно было задавать везде:

Размер шрифта вынесем в класс `size_m`:

![[Pasted image 20241107182724.png]]

##### Терь сразу сделаем story и посмотрим, как это будет выглядеть. Скопируем `outline` кнопку и изменим скопированный блок на:

![[Pasted image 20241107182903.png]]


Тоже самое сделаем и для `XL`-кнопки:

![[Pasted image 20241107182942.png]]

#### Получаем:

![[Pasted image 20241107182955.png]]


#### Всё заебись, но терь проблема следующая:

Вот оно в развёрнутом состоянии:

![[Pasted image 20241107183126.png]]

Вот оно в свёрнутом:

![[Pasted image 20241107183149.png]]

Т.е. мы когда сворачиваем, происходит разрыв жопы

> `Sidebar.module.scss`:

Вот у нас класс, отвечающий за расположение `switcher`'ов:

![[Pasted image 20241107184002.png]]

Т.к. мы используем `scss`, то прям внутри `collapsed`:

![[Pasted image 20241107184039.png]]

Т.е. сделаем это в столбик


Также в свёрнутом виде у нас щас полная надпись "русский" или "enlgish":

![[Pasted image 20241107184157.png]]


Чтобы было просто `ru` или `en`, зайдём в

> `LangSwitcher.tsx`:

Добавим boolean-флаг, в завимисоти от которого будет либо полное название языка, либо укороченное:

![[Pasted image 20241107184437.png]]

Терь добавим условие вот тут:

![[Pasted image 20241107184526.png]]


Пойдём в файл с переводами:

![[Pasted image 20241107184705.png]]

![[Pasted image 20241107184729.png]]



Возвращаемся в:

> `Sidebar.tsx`:

Тут прокинем prop `short`, который будет равен `true` тогда, когда Sidebar у нас свёрнут:

![[Pasted image 20241107184910.png]]

Терь у нас вот так:

![[Pasted image 20241107184938.png]]

Только по горизонтали оно не выравнено. Для этого:

> `Sidebar.module.scss`:

![[Pasted image 20241107185052.png]]

У нас вот тут:

![[Pasted image 20241107185129.png]]

Ругается ESLint'er, потому что мы перезатираем классы. У нас тут `collapsed` класс, внутри которого:

![[Pasted image 20241107185222.png]]

Т.е. по этой причине у нас класс `switchers` должен идти выше перед ним

![[Pasted image 20241107185309.png]]

Щас у нас хуй чё поменялось:

![[Pasted image 20241107185405.png]]

У нас тут класс навешивается с отступами влево

### Терь перенесём ссылки из `header`'а в Sidebar:

![[Pasted image 20241107185531.png]]

Типо, если в `Header`'е будет много ссылок, они не уместятся там просто. +, Sidebar, сам по себе, для этого и нужен

> `Navbar.tsx`:

![[Pasted image 20241107185721.png]]

![[Pasted image 20241107185658.png]]

![[Pasted image 20241107185739.png]]

>`Sidebar.tsx`:

Вот тут под кнопкой сделаем `<div>`:

![[Pasted image 20241107185837.png]]

И терь так:

![[Pasted image 20241107185851.png]]


На сам блок повешаем ещё класс:

![[Pasted image 20241107185926.png]]

#### Сразу напишем стили для этого:

> `Sidebar.modules.scss`:

![[Pasted image 20241107190033.png]]


Щас у нас в 

>`Sidebar.tsx`:

за'hardcode'жены ссылки:

![[Pasted image 20241107190132.png]]

Это делать не по феншую


Для этого есть специальный объект - `RoutePath`, где у нас и находятся все константы для ссылок:

![[Pasted image 20241107190728.png]]

(тут мы ещё названия классов ссылок поменяли на `link`)


Получается щас вот так:

![[Pasted image 20241107190813.png]]

Добавим отступы слева:

>`Sidebar.module.scss`:

![[Pasted image 20241107190855.png]]


### Щас идея такая:

##### В развёрнутом состояни:

![[Pasted image 20241107190956.png]]


##### В свёрнутом состоянии:

![[Pasted image 20241107191035.png]]

##### Мы хотим сделать так, чтобы в свёрнутом состоянии вместо текста были иконки


##### Иконки сами мы возьмём из `Figma`:

![[Pasted image 20241107191146.png]]

Их экспортируем в папку `assets`

![[Pasted image 20241107191218.png]]


Единственное, у нас щас вот тут:

![[Pasted image 20241107191256.png]]

И вот тут:

![[Pasted image 20241107191316.png]]

Свойство `fill`

#### Вырезаем его
![[Pasted image 20241107191421.png]]


Тоже самое в файле `about`:

![[Pasted image 20241107191447.png]]

Тут у нас чуть меньше, чем дохуя строк и везде используется `fill`


#### Нажмём `ctrl + R`:

В верхней строчке пишем чё хотим заменить, в нижней на что:

![[Pasted image 20241107191626.png]]

И не забывам убрать вот это:

![[Pasted image 20241107191659.png]]

Возвращаемся к:

> `Sidebar.tsx`:


![[Pasted image 20241107192244.png]]

Терь для каждой из ссылок добавим эти иконки:

Чтобы выровнять правильно иконку с самим текстом, создадим ещё один класс - класс `item`, а для иконок будет класс `item`:

![[Pasted image 20241107192544.png]]

Терь саму ссылку перенесём внутрь блока:

![[Pasted image 20241107192636.png]]

Вот так:


![[Pasted image 20241107192648.png]]

Продублируем эту конструкцию 

![[Pasted image 20241108145405.png]]

Плюс заменим `MainIcon` на `AboutIcon`

И заменим ссылку на правильную:

![[Pasted image 20241108145531.png]]

Щас у нас вот так:

![[Pasted image 20241108145601.png]]

Но иконки чёрные + ещё не выровнены

> `Sidebar.module.scss`:


![[Pasted image 20241108145748.png]]

![[Pasted image 20241108145810.png]]

Щас вот так:

![[Pasted image 20241108145900.png]]

По мнению Ulbi, это некрасиво 

В общем, нам тут нужно использовать не `--secondary-color`

> `AppLinl.module.scss`:

Вот тут:

![[Pasted image 20241108150009.png]]

класс мы назвали `secondary`, а используется, по факту, `inverted-primary`

Это надо было назвать не `secondary`, а `inverted

> `Sidebar.module.scss`:

```SCSS:
.Sidebar {  
    height: calc(100vh - var(--navbar-height));  
    width: var(--sidebar-width);  
    background: var(--inverted-bg-color);  
    position: relative;  
    transition: width 0.3s;  
}  
  
.switchers {  
    position: absolute;  
    bottom: 20px;  
    display: flex;  
    justify-content: center;  
    width: 100%;  
}  
  
.collapsed {  
    width: var(--sidebar-width-collapsed);  
  
    .switchers {  
        flex-direction: column;  
        align-items: center;  
    }  
}  
  
.lang {  
    margin-left: 20px;  
}  
  
.collapsedBtn {  
    position: absolute;  
    right: -32px;  
    bottom: 32px;  
    display: flex;  
    justify-content: center;  
    align-items: center;  
    padding: 2px 3px;  
}  
  
.items {  
    margin-top: 20px;  
    margin-left: 30px;  
    display: flex;  
    flex-direction: column;  
}  
  
.link {  
    margin-top: 10px;  
}  
  
.item {  
    margin-top: 10px;  
    display: flex;  
    align-items: center;  
}  
  
.link {  
    margin-left: 10px;  
}  
  
.icon {  
    fill: var(--inverted-primary-color);  
}
```

> `Sidebar.module.scss`:

Sidebar идёт с цветом `inverted`, поэтому для этого шрифта тоже необходимо сделать `inverted`

И щас у нас вот так:

![[Pasted image 20241108150247.png]]

При сворачивании:

![[Pasted image 20241108150451.png]]

>`Sidebar.module.scss`:

Класс `.collapsed` перенесём в самый низ:

И добавим на `link` переопределяющие стили:

![[Pasted image 20241108150556.png]]

Т.е. ссылку будем делать прозрачными 

И, чтобы не было резко, добавим анимацию:


![[Pasted image 20241108150638.png]]

Плюс ширину сделаем `0`, чтобы она не мешалась:

![[Pasted image 20241108150750.png]]

А на верхнем уровне:

![[Pasted image 20241108150815.png]]

Теперь при сворачивании:

![[Pasted image 20241108151347.png]]

#### Но есть нюанс:

Эти иконки обёрнуты в `div` и не кликабельны


> `Sidebar.tsx`:

Для item'а придётся поменять структуру:

Перенесём иконку внутри ссылки, чтобы она стала кликабельной:


![[Pasted image 20241108152207.png]]

Вот так:

![[Pasted image 20241108152222.png]]

А сам текст ссылки обернём в `<span>`:

![[Pasted image 20241108152437.png]]

Это, чтобы иконку от текста потом отлепить

Сам компонент `AppLink` - в него переносим `.item`

![[Pasted image 20241108152603.png]]

Терь в качестве обёртки выступает сама ссылка

![[Pasted image 20241108152729.png]]


#### Запушим текущий вариант на github:

action'ы запустились:

![[Pasted image 20241108153211.png]]

Видим, что Unit-тесты упали

SB и скриншот-тесты даже не начали запускаться. Это потому что конфиг сейчас настроен таким образом, что все проверки выполняются одна за другой:

> `main.yml`:

![[Pasted image 20241108153402.png]]

Если одна из них падает, то падает всё


Исправляется это вот так:

![[Pasted image 20241108153517.png]]

![[Pasted image 20241108153558.png]]


Для `npm run install`, т.е. для установки зависимостей, мы это не добавляем, потому что зависимости должны устанавливаться всегда

Терь у нас ругается на `<Router>`:

![[Pasted image 20241108153729.png]]

Т.е. мы изменили компонент `<Sidebar>`, добавили туда ссылки, но не ааптировали тесты 

Похожую проблему мы решали для SB, оборачивая там всё в декоратор вот так:

>`RouterDecorator.tsx`:

![[Pasted image 20241108153858.png]]

Но это для SB. Нам щас нужно сделать нечто похожее, но для JEST-тестов



В папке `./lib` внутри папки `./tests` создаём папку `./renderWithTranslation`, внутри которой создаём одноимённый `.tsx`-компонент:

![[Pasted image 20241108154238.png]]

Но такое, по мнению Ulbi, избыточно: мы отдельно работаем с переводами, отдельно с роутерами. Если такое поведение, в случае с декораторами, можно понять, то в случае рендера - это избыточно

Поэтому сделаем одну единственную функцию - `componentRender` - и её во всех случаях будем использовать:


>`renderWithRouter.tsx`:

![[Pasted image 20241108154456.png]]

![[Pasted image 20241108154700.png]]



![[Pasted image 20241108155134.png]]

Также мы сюда передаём `i18config`, который мы делали специально для тестов


Терь вот этот чанк кода, что выше написали - его перенесём в новый `componentRender.tsx`:

![[Pasted image 20241108155423.png]]

(переименуем ещё всё)

От остальных двух функций можно избавиться, точнее только от `renderWithRouter`. Но `renderWithTranslation` используется ещё в каких-то местах, поэтому её оставим

> `componentRender.tsx`:

![[Pasted image 20241108160723.png]]


> `Sidebar.test.tsx`:

Терь вот это:

![[Pasted image 20241108160803.png]]

Заменяем на

![[Pasted image 20241108160841.png]]


Щас TS ругается - требует второй аргумент в `componentRender`

Его по умолчанию проинициализируем пустым объектом + ещё `route` сделаем необязательным объектом

> `componentRender.tsx`:

![[Pasted image 20241108161031.png]]


#### Попробуем ёбнуть тесты:

```BASH:
npm run test:unit Sidebar.test.tsx
```

![[Pasted image 20241108161854.png]]

Тесты запустились, оба успешны:

![[Pasted image 20241108161919.png]]

#### Закоммитим на github:

![[Pasted image 20241108162007.png]]

Тут видим, что упали тесты

Во-первых, мы добавили кучу новых stories для кнопок, во-вторых, изменили полностью `Sidebar` + из-за того, что изменили кнопки и отступы, у нас попадали все тесты для страниц, для которых использовались кнопки

#### Прогоним локально скриншотные тесты:

```BASH:
npm run test:ui
```

чтобы посмотреть, где отличия

Тесты запустились

В папке `./loki`, внутри `./difference`, видим дохуя файлов:

![[Pasted image 20241108162309.png]]

Щас у нас скрины полупустые, но дальше, когда компоненты будут нагруженные и сложные, смотреть это будет невыносимо

#### Вот тут:

```URL:
https://github.com/reg-viz/reg-cli
```

Это `CLI` для сравнения в удобном интерфейсе две картинки


Ёбнем её через:

```BASH:
npm i -D reg-cli
```

 В [обсуждении](https://github.com/reg-viz/reg-cli) есть вот это:

![[Pasted image 20241108163432.png]]

Там есть написанный скрипт на Node JS:

![[Pasted image 20241108164035.png]]


В папке `./scripts` в корне проекта создадим такой скрипт. В этой папке будем хранить все скрипты, которые так или иначе связаны с нашим приложением

![[Pasted image 20241108164152.png]]

Скопируем с сайта и вставим:

![[Pasted image 20241108164213.png]]


#### Как теперь это всё запускать?

Там представлено несколько скриптов:

![[Pasted image 20241108164308.png]]

Скопируем второй - тот, который генерирует JSON-файл:

```BASH:
node scripts/generate-visual-json-report.js
```

В папке `./loki` появился `report.josn`:

![[Pasted image 20241108164450.png]]

Терь скопируем ту строчку, которая нужна для HTML - Того самого интерфейса, пользовться которым мы будем 

```BASH:
reg-cli --from .loki/report.json --report .loki/report.html
```

Появился:

![[Pasted image 20241108164723.png]]

откроем его в браузере


### Терь подтвердим скрины:

```BASH:
npm run test:ui:ok
```

Терь сами те скрипты добавим

![[Pasted image 20241108165013.png]]

Ещё сделаем скрипт, который эти вышеперечисленные два скрипта объединяет:


![[Pasted image 20241108165113.png]]

Если мы удалим тот `html` и `js` файлы и выполним:

```BASH:
npm run test:ui:report
```


![[Pasted image 20241108165330.png]]

Щас ёбнем всё в github. Единственное, отчёты такие выгружать в github смысла нет, поэтому добавим их в `.gitignore`:

> `.gitignore`:

![[Pasted image 20241108170131.png]]

